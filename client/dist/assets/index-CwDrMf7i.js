const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/login-CFqHKcRM.js","assets/vendor-BHEUBfle.js","assets/scanner-vendor-DfxRpMWJ.js","assets/pdf-vendor-BzGOTXeo.js","assets/Dashboard-ByAILsBy.js","assets/ConfirmationModal-B5FLFSjM.js","assets/POS.styles-Dbi1_TMg.js","assets/UserManagement-BU8ckhlv.js","assets/InventoryManagement-7IF6cuvL.js","assets/PedidosYApartados-xeWo0vV7.js","assets/ClientesYCreditos-BVIWlHEB.js","assets/SalesHistoryModal-CGUDDhFv.js","assets/AlertModal-DAjc3Hhf.js","assets/Finances-DW8JDcPg.js","assets/POS-B5u9LycY.js","assets/Reports-CtVUuw9g.js","assets/Unauthorized-_lQdKa9G.js","assets/InventoryUpload-CQbaT5LZ.js","assets/CashReport-BQs63Ozp.js","assets/FacturasProveedores-B5UYN5Bi.js","assets/Solicitudes-DtE_0KvE.js","assets/InventoryOutflowPage-KfI3iowT.js","assets/DetailedSalesReport-CCaDP0Q8.js","assets/SettingsPage-CoohoZZT.js"])))=>i.map(i=>d[i]);
import{b as me,r as c,u as ge,j as r,R as _,N as J,c as he,F as ye,A as we,e as je,f as S,m as A,l as xe,g as ve,B as _e}from"./vendor-BHEUBfle.js";import{_ as E}from"./pdf-vendor-BzGOTXeo.js";import"./scanner-vendor-DfxRpMWJ.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))s(o);new MutationObserver(o=>{for(const a of o)if(a.type==="childList")for(const h of a.addedNodes)h.tagName==="LINK"&&h.rel==="modulepreload"&&s(h)}).observe(document,{childList:!0,subtree:!0});function n(o){const a={};return o.integrity&&(a.integrity=o.integrity),o.referrerPolicy&&(a.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?a.credentials="include":o.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function s(o){if(o.ep)return;o.ep=!0;const a=n(o);fetch(o.href,a)}})();const ae="/api",ut=ae,Se=15e3,Ee=2,l=async(e,t,n=null,s=null,o={})=>{var I,j;const a={"Content-Type":"application/json",...o.headers||{}};n&&(a.Authorization=`Bearer ${n}`);const h=`${ae}${t}`,g=String(e||"get").toLowerCase(),R=g==="get"?Ee:0;for(let T=0;T<=R;T++)try{const w={url:h,method:g,headers:a,timeout:o.timeout||Se,withCredentials:!!o.withCredentials,...o};return s!==null&&g!=="get"&&(w.data=s),o.params&&g==="get"&&(w.params=o.params),(await me.request(w)).data}catch(w){if(w.response){const i=((I=w.response.data)==null?void 0:I.message)||((j=w.response.data)==null?void 0:j.msg)||JSON.stringify(w.response.data),m=new Error(i||`HTTP ${w.response.status}`);throw m.status=w.response.status,m}if(T>=R){const i=new Error(w.code==="ECONNABORTED"?"Tiempo de espera agotado. Verifica tu conexiÃ³n a internet.":w.message||"Error de conexiÃ³n con el servidor.");throw i.isNetworkError=!0,i}const y=500*Math.pow(2,T);console.warn(`âš ï¸ Reintentando ${t} (intento ${T+2}/${R+1}) en ${y}ms...`),await new Promise(i=>setTimeout(i,y))}},ft=async e=>{const{username:t,nombre_usuario:n,password:s}=e;return await l("post","/auth/login",null,{nombre_usuario:n??t,password:s})},X=async e=>await l("get","/users",e),ee=async e=>{const t=await l("get","/products",e);return(Array.isArray(t)?t:[]).map(s=>({id:s.id_producto??s.id??s._id,id_producto:s.id_producto??s.id??s._id,codigo:s.codigo??s.code??"",nombre:s.nombre??s.nombre_producto??s.name??"Sin nombre",precio:Number(s.venta??s.precio??s.price??0),precio_venta:Number(s.venta??s.precio??s.price??0),existencia:Number(s.existencia??s.stock??0),imagen:s.imagen||null,descripcion:s.descripcion||"",categoria:s.nombre_categoria||"",costo:Number(s.costo||0),mayorista:Number(s.mayoreo||s.mayorista||0),raw:s}))},te=async e=>{const t=await l("get","/clients",e),n=Array.isArray(t)?t:[],s=n.find(a=>(a.nombre||"").toLowerCase().includes("contado")),o=n.filter(a=>s?a.id_cliente!==s.id_cliente:!0);return s?[s,...o]:n},Ae=async e=>await l("get","/categories",e),Ie=async e=>await l("get","/providers",e),pt=async(e,t=null)=>{const n={};return t&&(n.params={date:t}),await l("get","/sales",e,null,n)},mt=async(e,t)=>await l("post","/sales",t,e),gt=async(e,t)=>await l("post","/sales/returns",t,e),ht=async(e,t)=>await l("delete",`/sales/${e}`,t),Ce=async e=>await l("GET","/orders/pending",e),yt=(e,t)=>l("POST","/clients",t,e),wt=(e,t,n)=>l("PUT",`/clients/${e}`,n,t),jt=(e,t)=>l("DELETE",`/clients/${e}`,t),xt=(e,t,n)=>l("POST",`/clients/${e}/abono`,n,t),vt=(e,t)=>l("GET",`/clients/${e}/creditos`,t),_t=(e,t)=>l("GET",`/clients/${e}/abonos`,t),St=(e,t)=>l("GET",`/clients/${e}/creditos-pendientes`,t),Et=(e,t)=>l("get","/reports/sales-summary",e,null,{params:t}),At=e=>l("get","/reports/inventory-value",e),It=(e,t)=>l("get","/reports/sales-by-user",e,null,{params:t}),Ct=(e,t)=>l("get","/reports/top-products",e,null,{params:t}),Nt=(e,t)=>l("get","/reports/sales-chart",e,null,{params:t}),Dt=async(e,t)=>await l("post","/upload/inventory",t,{items:e}),Ne=async(e,t)=>{const n=localStorage.getItem("token");return await l("get","/caja/session",n,null,{params:{userId:e}})},Rt=async(e,t)=>await l("post","/caja/session/open",t,e),De=async(e,t)=>await l("post","/caja/session/tx",t,e),Ot=async(e,t)=>await l("post","/caja/session/close",t,e),Tt=async e=>await l("get","/caja/abiertas/activas",e),Pt=async e=>await l("get","/facturas-proveedores",e),bt=async(e,t)=>await l("post","/facturas-proveedores",t,e),Lt=async(e,t,n)=>await l("post",`/facturas-proveedores/${e}/pagar`,n,{amount:t}),kt=async(e,t)=>await l("delete",`/facturas-proveedores/${e}`,t),se=async(e,t)=>await l("get","/caja/cart",t,null,{params:{userId:e}}),Re=async(e,t,n)=>await l("post","/caja/cart",n,{userId:e,carts:t}),zt=async e=>await l("get","/requests",e),$t=async(e,t)=>await l("post","/requests",t,e),Ut=async(e,t,n)=>await l("put",`/requests/${e}/toggle`,n,{completed:t}),Vt=async(e,t,n)=>await l("put",`/requests/${e}`,n,{descripcion:t}),Mt=async(e,t)=>await l("delete",`/requests/${e}`,t),Bt=async(e,t)=>await l("post","/outflow",t,e),Ft=async e=>await l("get","/outflow/history",e),Oe=e=>{const t=e instanceof Date?e:new Date(e),n=t.getTimezoneOffset()*6e4;return new Date(t.getTime()-n).toISOString().split("T")[0]},W=(e,t)=>`caja_session_${e}_${Oe(t)}`,Z=e=>`caja_session_index_${e}`,re=(e,t)=>{if(!e){const o=String(t??"").trim();return o?{id:o,name:`Usuario ${o}`}:null}if(typeof e!="object")return{name:String(e)};const n=String(e.id??t??"").trim(),s=e.name??e.nombre??e.fullName??e.displayName??e.nombre_usuario??e.username??(n?`Usuario ${n}`:void 0);return{...e,...n?{id:n}:{},...s?{name:s}:{}}},ne=e=>{if(!e)return null;try{const t=localStorage.getItem(Z(e));if(t){const s=localStorage.getItem(t);if(s)return JSON.parse(s)}const n=localStorage.getItem(W(e,new Date));return n?JSON.parse(n):Pe(e)}catch(t){return console.error("Error al cargar la sesiÃ³n de caja:",t),null}},Te=(e,t)=>{var n;if(!(!e||!t))try{const s={...t};s.openedBy&&(s.openedBy=re(s.openedBy,e)),s.closedBy&&(s.closedBy=re(s.closedBy,((n=s.closedBy)==null?void 0:n.id)||e));const o=s.openedAt?new Date(s.openedAt):new Date,a=W(e,o);localStorage.setItem(a,JSON.stringify(s)),localStorage.setItem(Z(e),a)}catch(s){console.error("Error al guardar la sesiÃ³n de caja:",s)}},Pe=e=>{if(!e)return null;try{const t=new Date;for(let n=1;n<=7;n++){const s=new Date(t);s.setDate(t.getDate()-n);const o=W(e,s),a=localStorage.getItem(o);if(a){const h=JSON.parse(a);if(h&&!h.closedAt)return localStorage.setItem(Z(e),o),h}}return null}catch(t){return console.error("Error buscando sesiones antiguas:",t),null}},ie=c.createContext(null),be=({children:e,socket:t})=>{const[n,s]=c.useState(null),[o,a]=c.useState([]),[h,g]=c.useState([]),[L,R]=c.useState([]),[I,j]=c.useState([]),[T,w]=c.useState([]),[P,y]=c.useState(!0),i=ge(),[m,v]=c.useState(()=>localStorage.getItem("token")),[u,b]=c.useState(null),C=c.useRef(null),N=c.useCallback(()=>{localStorage.removeItem("token"),localStorage.removeItem("user"),s(null),v(null),i("/login")},[i]),K="masterDataCache",V=c.useCallback(async(f,x=!1)=>{try{const p=await Promise.allSettled([X(f),ee(f),te(f),Ae(f),Ie(f)]),k=p[0].status==="fulfilled"?p[0].value||[]:null,$=p[1].status==="fulfilled"?p[1].value||[]:null,U=p[2].status==="fulfilled"?p[2].value||[]:null,O=p[3].status==="fulfilled"?p[3].value||[]:null,G=p[4].status==="fulfilled"?p[4].value||[]:null;k&&a(k),$&&g($),U&&R(U),O&&j(O),G&&w(G);try{const M={users:k||[],products:$||[],clients:U||[],categories:O||[],providers:G||[],timestamp:Date.now()};localStorage.setItem(K,JSON.stringify(M))}catch{}p.every(M=>{var Q;return M.status==="rejected"&&((Q=M.reason)==null?void 0:Q.status)===401})&&N()}catch(p){console.error("Fallo crÃ­tico cargando datos maestros:",p),p.status===401&&N()}},[N]),H=c.useCallback(()=>{var f,x,p,k,$;try{const U=localStorage.getItem(K);if(U){const O=JSON.parse(U);return(f=O.users)!=null&&f.length&&a(O.users),(x=O.products)!=null&&x.length&&g(O.products),(p=O.clients)!=null&&p.length&&R(O.clients),(k=O.categories)!=null&&k.length&&j(O.categories),($=O.providers)!=null&&$.length&&w(O.providers),!0}}catch{}return!1},[]),q=c.useCallback(async()=>{if(m)try{const f=await ee(m);g(f||[])}catch(f){f.name!=="CanceledError"&&console.error("Error updating inventory:",f.message)}},[m]),Y=c.useCallback(()=>{C.current&&clearTimeout(C.current),C.current=setTimeout(()=>{q()},300)},[q]),B=c.useCallback(async()=>{const f=localStorage.getItem("token");if(f)try{const x=await te(f);R(x||[])}catch{}},[]);c.useEffect(()=>{if(!t)return;const f=()=>{Y()};return t.on("inventory_update",f),t.on("products:update",f),t.on("clients:update",B),t.on("users:update",async()=>{const x=localStorage.getItem("token");if(x)try{const p=await X(x);a(p||[])}catch{}}),()=>{C.current&&clearTimeout(C.current),t.off("inventory_update",f),t.off("products:update",f),t.off("clients:update",B),t.off("users:update")}},[t,Y,B]),c.useEffect(()=>{(async()=>{y(!0);try{const x=localStorage.getItem("token"),p=localStorage.getItem("user");if(x&&p)try{const k=JSON.parse(p);s(k),v(x),H()?(y(!1),V(x,!0).catch(console.warn)):(await V(x),y(!1))}catch{N()}}finally{y(x=>x&&!1)}})()},[N,V,H]);const ue=async(f,x)=>{localStorage.setItem("token",x),localStorage.setItem("user",JSON.stringify(f)),s(f),v(x),y(!0),await V(x),y(!1),i("/dashboard")};c.useEffect(()=>{if(n){const f=n.id_usuario||n.id;b(ne(f))}else b(null)},[n]);const fe=c.useCallback(async f=>{if(!n)return;const x=n.id_usuario||n.id,p=ne(x);p&&!p.closedAt&&(p.transactions=[...p.transactions||[],f],Te(x,p),b(p));try{await De({userId:x,tx:f},m)}catch(k){console.error("âŒ Error sincronizando transacciÃ³n de caja:",k)}},[n,m]),pe={user:n,token:m,allUsers:o,products:h,clients:L,categories:I,providers:T,isLoading:P,login:ue,logout:N,loadMasterData:V,refreshProducts:q,refreshClients:B,cajaSession:u,setCajaSession:b,addCajaTransaction:fe};return P&&!n?r.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",height:"100vh",background:"#f8fafc",color:"#64748b"},children:[r.jsx("div",{className:"spinner",style:{width:"50px",height:"50px",border:"5px solid #e2e8f0",borderTop:"5px solid #3b82f6",borderRadius:"50%",animation:"spin 1s linear infinite"}}),r.jsx("h3",{style:{marginTop:"20px",fontWeight:600},children:"Cargando Sistema..."}),r.jsx("style",{children:`
                    @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
                `})]}):r.jsx(ie.Provider,{value:pe,children:e})},F=()=>{const e=c.useContext(ie);if(!e)throw new Error("useAuth debe ser usado dentro de un AuthProvider");return e},ce=c.createContext(null),Le=({children:e,user:t,socket:n})=>{const s=(t==null?void 0:t.id_usuario)||(t==null?void 0:t.id),[o,a]=c.useState(!1),[h,g]=c.useState(null),[L,R]=c.useState(36.6),I=c.useCallback(async()=>{var w,P;if(s)try{const y=await Ne(s);y&&!y.closedAt?(g(y),a(!0),y.tasaDolar&&R(Number(y.tasaDolar))):(g(null),a(!1))}catch(y){if(y.isNetworkError||(w=y.message)!=null&&w.includes("timeout")||(P=y.message)!=null&&P.includes("conexiÃ³n")||!y.status){console.warn("âš ï¸ Error de red al sincronizar caja (manteniendo estado actual):",y.message);return}console.error("âŒ Error de servidor al sincronizar caja:",y),g(null),a(!1)}},[s]);c.useEffect(()=>{if(!s){a(!1),g(null);return}if(I(),n){const P=i=>{(!i||!i.userId||i.userId===s)&&(console.log("âš¡ Socket: caja session update"),I())},y=i=>{(!i||!i.userId||i.userId===s)&&(console.log("âš¡ Socket: New Tx"),I())};return n.on("caja:session_update",P),n.on("caja:transaction_new",y),()=>{n.off("caja:session_update",P),n.off("caja:transaction_new",y)}}const w=setInterval(I,6e4);return()=>{clearInterval(w)}},[s,I,n]);const T={isCajaOpen:o,setIsCajaOpen:a,cajaSession:h,setCajaSession:g,tasaDolar:L,setTasaDolar:R,closeCajaSession:()=>{s&&(g(null),a(!1))},refreshSession:I};return r.jsx(ce.Provider,{value:T,children:e})},qt=()=>{const e=c.useContext(ce);if(!e)throw new Error("useCaja must be used within CajaProvider");return e},le=c.createContext(null),ke=({children:e})=>{const[t,n]=c.useState([]),[s,o]=c.useState(null),[a,h]=c.useState(null),g=t.find(i=>i.id===s)||{items:[]},L=c.useCallback(async i=>{if(!i)return;h(i);try{const v=localStorage.getItem("token"),u=await se(i,v);if(u&&Array.isArray(u)&&u.length>0){n(u),o(u[0].id);return}}catch(v){console.error("Error loading carts from DB, falling back to local:",v)}const m=[{id:Date.now(),name:"Ticket 1",items:[]}];n(m),o(m[0].id)},[]);c.useEffect(()=>{if(a&&t.length>0){const i=setTimeout(()=>{const m=localStorage.getItem("token");Re(a,t,m).catch(v=>console.error("Error saving cart:",v))},1e3);return()=>clearTimeout(i)}},[t,a]);const R=()=>{const i={id:Date.now(),name:`Ticket ${t.length+1}`,items:[]};n(m=>[...m,i]),o(i.id)},I=i=>{w.current&&(w.current.add(String(i)),setTimeout(()=>{w.current&&w.current.delete(String(i))},1e4));let m=[];n(u=>{const b=u.filter(C=>C.id!==i);if(b.length===0){const C={id:Date.now(),name:"Ticket 1",items:[]};m=[C],C.id}else m=b,s===i&&b[0].id;return m});const v=t.filter(u=>u.id!==i);if(v.length===0){const u={id:Date.now(),name:"Ticket 1",items:[]};n([u]),o(u.id)}else n(v),s===i&&o(v[0].id)},j=(i,m)=>{n(v=>v.map(u=>u.id===s?{...u,[i]:m}:u))},T=async()=>{try{const i=localStorage.getItem("token"),m=await Ce(i);if(m&&m.length>0){const v=m.map(u=>({id:`server_${u.id_pedido}`,serverSaleId:u.id_pedido,name:`Pedido #${u.id_pedido}`,items:u.items||[],client:u.cliente}));n(u=>{const b=new Set(u.map(N=>N.id)),C=v.filter(N=>!b.has(N.id));return[...u,...C]})}}catch(i){console.error("Error loading pending orders",i)}},w=_.useRef(new Set),P=c.useCallback(async i=>{if(i)try{const m=localStorage.getItem("token"),v=await se(i,m);v&&Array.isArray(v)&&n(u=>{const b=new Set(u.map(N=>N.id)),C=v.filter(N=>!b.has(N.id)&&!w.current.has(String(N.id)));return C.length>0?[...u,...C]:u})}catch{}},[]),y={orders:t,setOrders:n,activeOrderId:s,setActiveOrderId:o,activeOrder:g,handleNewOrder:R,handleRemoveOrder:I,updateActiveOrder:j,loadOrdersFromDB:L,loadPendingOrdersFromServer:T,checkForNewOrders:P};return r.jsx(le.Provider,{value:y,children:e})},Gt=()=>{const e=c.useContext(le);if(!e)throw new Error("useOrders must be used within OrdersProvider");return e},ze=async e=>{try{const t=await fetch("undefined/settings",{headers:{Authorization:`Bearer ${e}`}});if(!t.ok){const s=await t.text();return console.warn("Settings API Error:",t.status,s.substring(0,100)),null}const n=t.headers.get("content-type");return!n||!n.includes("application/json")?(console.warn("Settings API returned non-JSON:",n),null):await t.json()}catch(t){return console.error("getSettings error:",t),null}},Jt=async(e,t)=>{const n=await fetch("undefined/settings",{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${e}`},body:JSON.stringify(t)});if(!n.ok)throw new Error("Error al actualizar configuraciÃ³n");return await n.json()},Wt=async(e,t)=>new Promise((n,s)=>{const o=new FileReader;o.readAsDataURL(t),o.onload=async()=>{try{const a=await fetch("undefined/settings/logo",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${e}`},body:JSON.stringify({logo:o.result})});if(!a.ok)throw new Error("Error subiendo logo");const h=await a.json();n(h.logoUrl)}catch(a){s(a)}},o.onerror=a=>s(a)}),de=c.createContext(),$e=({children:e})=>{const{token:t}=F(),[n,s]=c.useState({empresa_nombre:"Multirepuestos RG",empresa_ruc:"1211812770001E",empresa_telefono:"84031936 / 84058142",empresa_direccion:"Del portÃ³n de la normal 75 varas al este. Juigalpa, Chontales.",empresa_eslogan:"Repuestos de confianza al mejor precio â€” calidad que mantiene tu motor en marcha.",empresa_logo_url:""}),[o,a]=c.useState(!0),h=async()=>{if(t)try{const g=await ze(t);g&&s(L=>({...L,...g}))}catch(g){console.error("Error loading settings:",g)}finally{a(!1)}};return c.useEffect(()=>{h()},[t]),r.jsx(de.Provider,{value:{settings:n,refreshSettings:h,loading:o},children:e})},Zt=()=>c.useContext(de),D=({children:e,allowedRoles:t})=>{const{user:n,isLoading:s}=F();return s?r.jsx("div",{style:{padding:"2rem"},children:"Cargando..."}):n?t&&Array.isArray(t)&&!t.includes(n.rol)?r.jsx(J,{to:"/unauthorized",replace:!0}):e:r.jsx(J,{to:"/login",replace:!0})},Ue=_.lazy(()=>E(()=>import("./login-CFqHKcRM.js"),__vite__mapDeps([0,1,2,3]))),Ve=_.lazy(()=>E(()=>import("./Dashboard-ByAILsBy.js"),__vite__mapDeps([4,3,1,2,5,6]))),Me=_.lazy(()=>E(()=>import("./UserManagement-BU8ckhlv.js"),__vite__mapDeps([7,1,2]))),Be=_.lazy(()=>E(()=>import("./InventoryManagement-7IF6cuvL.js"),__vite__mapDeps([8,1,2,3]))),Fe=_.lazy(()=>E(()=>import("./PedidosYApartados-xeWo0vV7.js"),__vite__mapDeps([9,1,2,3]))),qe=_.lazy(()=>E(()=>import("./ClientesYCreditos-BVIWlHEB.js"),__vite__mapDeps([10,1,2,11,6,12,3]))),Ge=_.lazy(()=>E(()=>import("./Finances-DW8JDcPg.js"),__vite__mapDeps([13,1,2,12,6]))),Je=_.lazy(()=>E(()=>import("./POS-B5u9LycY.js"),__vite__mapDeps([14,1,2,6,11,12,5,3]))),We=_.lazy(()=>E(()=>import("./Reports-CtVUuw9g.js"),__vite__mapDeps([15,1,2,12,6,3]))),Ze=_.lazy(()=>E(()=>import("./Unauthorized-_lQdKa9G.js"),__vite__mapDeps([16,1,2]))),Ke=_.lazy(()=>E(()=>import("./InventoryUpload-CQbaT5LZ.js"),__vite__mapDeps([17,1,2,3]))),He=_.lazy(()=>E(()=>import("./CashReport-BQs63Ozp.js"),__vite__mapDeps([18,1,2,3]))),Ye=_.lazy(()=>E(()=>import("./FacturasProveedores-B5UYN5Bi.js"),__vite__mapDeps([19,1,2,3]))),Qe=_.lazy(()=>E(()=>import("./Solicitudes-DtE_0KvE.js"),__vite__mapDeps([20,1,2,3]))),Xe=_.lazy(()=>E(()=>import("./InventoryOutflowPage-KfI3iowT.js"),__vite__mapDeps([21,1,2,3]))),et=_.lazy(()=>E(()=>import("./DetailedSalesReport-CCaDP0Q8.js"),__vite__mapDeps([22,1,2,3]))),tt=_.lazy(()=>E(()=>import("./SettingsPage-CoohoZZT.js"),__vite__mapDeps([23,1,2,3]))),oe=()=>r.jsx("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",height:"100vh",color:"#64748b"},children:"Cargando..."}),d={ADMIN:"Administrador",VENDEDOR:"Vendedor",INVENTARIO:"Encargado de Inventario",FINANZAS:"Encargado de Finanzas",GERENTE:"Gerente",EMPLEADO:"Empleado"};function st(){const{user:e,isLoading:t}=F(),n=he();if(t)return r.jsx(oe,{});const s={initial:{opacity:0,x:-10},animate:{opacity:1,x:0},exit:{opacity:0,x:10},transition:{duration:.2,ease:"easeOut"}};return r.jsxs(_.Suspense,{fallback:r.jsx(oe,{}),children:[r.jsx(ye,{position:"top-center",reverseOrder:!1}),r.jsx(we,{mode:"wait",children:r.jsxs(je,{location:n,children:[r.jsx(S,{path:"/login",element:r.jsx(A.div,{...s,children:r.jsx(Ue,{})})}),r.jsx(S,{path:"/unauthorized",element:r.jsx(A.div,{...s,children:r.jsx(Ze,{})})}),r.jsx(S,{path:"/dashboard",element:r.jsx(D,{children:r.jsx(A.div,{...s,children:r.jsx(Ve,{})})})}),r.jsx(S,{path:"/pos",element:r.jsx(D,{allowedRoles:[d.ADMIN,d.VENDEDOR],children:r.jsx(A.div,{...s,children:r.jsx(Je,{})})})}),r.jsx(S,{path:"/inventory",element:r.jsx(D,{allowedRoles:[d.ADMIN,d.INVENTARIO],children:r.jsx(A.div,{...s,children:r.jsx(Be,{})})})}),r.jsx(S,{path:"/orders",element:r.jsx(D,{allowedRoles:[d.ADMIN,d.VENDEDOR,d.EMPLEADO],children:r.jsx(A.div,{...s,children:r.jsx(Fe,{})})})}),r.jsx(S,{path:"/credits",element:r.jsx(D,{allowedRoles:[d.ADMIN,d.VENDEDOR,d.FINANZAS],children:r.jsx(A.div,{...s,children:r.jsx(qe,{})})})}),r.jsx(S,{path:"/finances",element:r.jsx(D,{allowedRoles:[d.ADMIN,d.FINANZAS],children:r.jsx(A.div,{...s,children:r.jsx(Ge,{})})})}),r.jsx(S,{path:"/reports",element:r.jsx(D,{allowedRoles:[d.ADMIN,d.GERENTE,d.FINANZAS],children:r.jsx(A.div,{...s,children:r.jsx(We,{})})})}),r.jsx(S,{path:"/admin/users",element:r.jsx(D,{allowedRoles:[d.ADMIN],children:r.jsx(A.div,{...s,children:r.jsx(Me,{})})})}),r.jsx(S,{path:"/upload/inventory",element:r.jsx(D,{allowedRoles:[d.ADMIN,d.INVENTARIO],children:r.jsx(A.div,{...s,children:r.jsx(Ke,{})})})}),r.jsx(S,{path:"/cash-report",element:r.jsx(D,{allowedRoles:[d.ADMIN,d.GERENTE,d.FINANZAS],children:r.jsx(A.div,{...s,children:r.jsx(He,{})})})}),r.jsx(S,{path:"/traslados",element:r.jsx(D,{allowedRoles:[d.ADMIN,d.INVENTARIO],children:r.jsx(A.div,{...s,children:r.jsx(Xe,{})})})}),r.jsx(S,{path:"/detailed-sales-report",element:r.jsx(D,{allowedRoles:[d.ADMIN,d.GERENTE,d.FINANZAS],children:r.jsx(A.div,{...s,children:r.jsx(et,{})})})}),r.jsx(S,{path:"/invoices",element:r.jsx(D,{allowedRoles:[d.ADMIN,d.FINANZAS],children:r.jsx(A.div,{...s,children:r.jsx(Ye,{})})})}),r.jsx(S,{path:"/solicitudes",element:r.jsx(D,{allowedRoles:[d.ADMIN,d.VENDEDOR,d.INVENTARIO,d.FINANZAS,d.GERENTE],children:r.jsx(A.div,{...s,children:r.jsx(Qe,{})})})}),r.jsx(S,{path:"/settings",element:r.jsx(D,{allowedRoles:[d.ADMIN,d.GERENTE],children:r.jsx(A.div,{...s,children:r.jsx(tt,{})})})}),r.jsx(S,{path:"*",element:r.jsx(J,{to:e?"/dashboard":"/login",replace:!0})})]},n.pathname)})]})}const rt=window.location.host.includes("localhost")?"http://localhost:3001":window.location.origin,z=xe(rt,{path:"/socket.io/",transports:["polling","websocket"],reconnection:!0,reconnectionAttempts:1/0,reconnectionDelay:1e3,reconnectionDelayMax:5e3,timeout:2e4,autoConnect:!0,withCredentials:!0});z.on("connect",()=>{console.log("âœ… Socket Connected (v2.1):",z.id),console.log("ðŸš€ Connection Transport:",z.io.engine.transport.name)});z.io.engine.on("upgrade",e=>{console.log("ðŸš€ Transport Upgraded to:",e.name)});z.on("connect_error",e=>{console.warn("âš ï¸ Socket Connection Error:",e.message)});z.on("disconnect",e=>{console.warn("âŒ Socket Disconnected:",e),e==="io server disconnect"&&z.connect()});function nt(e={}){const{immediate:t=!1,onNeedRefresh:n,onOfflineReady:s,onRegistered:o,onRegisteredSW:a,onRegisterError:h}=e;let g,L;const R=async(j=!0)=>{await L};async function I(){if("serviceWorker"in navigator){if(g=await E(async()=>{const{Workbox:j}=await import("./vendor-BHEUBfle.js").then(T=>T.bc);return{Workbox:j}},__vite__mapDeps([1,2])).then(({Workbox:j})=>new j("/sw.js",{scope:"/",type:"classic"})).catch(j=>{h==null||h(j)}),!g)return;g.addEventListener("activated",j=>{(j.isUpdate||j.isExternal)&&window.location.reload()}),g.addEventListener("installed",j=>{j.isUpdate||s==null||s()}),g.register({immediate:t}).then(j=>{a?a("/sw.js",j):o==null||o(j)}).catch(j=>{h==null||h(j)})}}return L=I(),R}const ot=({socket:e})=>{const{user:t}=F();return r.jsx(Le,{user:t,socket:e,children:r.jsx($e,{children:r.jsx(ke,{children:r.jsx(st,{})})})})},at=nt({onNeedRefresh(){confirm("Hay una nueva versiÃ³n disponible. Â¿Recargar ahora?")&&at(!0)},onOfflineReady(){console.log("App lista para trabajar offline")}});ve.createRoot(document.getElementById("root")).render(r.jsx(_.StrictMode,{children:r.jsx(_e,{children:r.jsx(be,{socket:z,children:r.jsx(ot,{socket:z})})})}));export{At as A,It as B,Ct as C,Nt as D,Dt as E,Pt as F,ut as G,bt as H,Lt as I,kt as J,zt as K,$t as L,Ut as M,Vt as N,Mt as O,Bt as P,Ft as Q,Zt as a,Wt as b,Jt as c,ee as d,wt as e,Tt as f,se as g,yt as h,St as i,vt as j,_t as k,ft as l,pt as m,jt as n,qt as o,Gt as p,Ot as q,Rt as r,Re as s,gt as t,F as u,ht as v,De as w,mt as x,xt as y,Et as z};
